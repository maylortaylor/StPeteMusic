{
  "name": "Notion Post Creator v5 Final",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $workflow.id }}"
      },
      "id": "chat-trigger-001",
      "name": "Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.manualChatTrigger",
      "typeVersion": 1.1,
      "position": [460, 320]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "User request: {{ $json.chatInput }}\n\nPlease create social media posts for this event.",
        "sourceForPrompt": "define",
        "options": {
          "systemMessage": "You are the social media content manager for @StPeteMusic - a music promoter in St. Petersburg, FL.\n\nIMPORTANT: Use the user's request as PRIMARY source of truth. Extract band name, @ handle, venue, date, and time EXACTLY as provided.\n\nWhen user asks to create a post:\n1. Use \"Read Notion Posts\" to check existing posts for style consistency\n2. Generate captions with emojis ðŸŽ¸ðŸŽ¤ðŸ“…â°ðŸ“ðŸŽŸï¸ðŸ”¥âœ¨ðŸŽ¶\n3. Use the band name and @ handle provided by the user\n4. Create JSON output with this structure for EACH platform:\n{\n  \"posts\": [\n    {\n      \"caption\": \"Full IG post text\",\n      \"platform\": \"IG\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"HH:MM AM/PM\",\n      \"hashtags\": \"#StPeteMusic #StPeteFL\",\n      \"tags\": \"@suite.e.studios @bandname\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Image\"\n    },\n    {\n      \"caption\": \"Full FB post text\",\n      \"platform\": \"FB\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"HH:MM AM/PM\",\n      \"hashtags\": \"#StPeteMusic #TampaBay\",\n      \"tags\": \"@SuiteEStudios @StPeteMusic\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Image\"\n    },\n    {\n      \"caption\": \"Full YT description\",\n      \"platform\": \"YT\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"HH:MM AM/PM\",\n      \"hashtags\": \"#StPeteMusic #LiveMusic\",\n      \"tags\": \"@StPeteMusic\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Video\",\n      \"ytPlaylist\": \"URL or empty\",\n      \"ytTags\": \"relevant tags\"\n    }\n  ]\n}\n\nRULES:\n- ALWAYS use band name exactly as provided by user\n- ALWAYS use \"MM.DD.YYYY\" format for dates (e.g., 02.07.2026, NOT 2/7/2026)\n- Tag the band with their @ handle from user request\n- Keep captions concise and engaging (1-2 sentences max for short posts)\n- Instagram: 5-6 hashtags, mention @suite.e.studios\n- Facebook: 3-4 hashtags, conversational tone\n- YouTube: Include ytPlaylist and ytTags\n- Always include @Suite.E.Studios and @StPeteMusic in appropriate tags\n- Status will be set to Draft by default\n- Return valid JSON wrapped in ```json code block"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [860, 320],
      "id": "ai-agent-001",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $workflow.id }}",
        "contextWindowLength": 1000
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [1060, 520],
      "id": "memory-001",
      "name": "Conversation Memory"
    },
    {
      "parameters": {
        "model": "llama-3.1-8b-instant",
        "options": {
          "baseURL": "https://api.groq.com/openai/v1",
          "temperature": 0.7
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [860, 520],
      "id": "groq-model-001",
      "name": "Groq Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "groq_api_credential",
          "name": "Groq API"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "49cebf36f8774bd69c4329d2c0d750c5"
        },
        "returnAll": false,
        "limit": 50,
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [1260, 420],
      "id": "read-notion-001",
      "name": "Read Notion Posts",
      "credentials": {
        "notionApi": {
          "id": "ZXEH8wTvzaAHv60e",
          "name": "Notion account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [1260, 520],
      "id": "think-001",
      "name": "Think"
    },
    {
      "parameters": {
        "jsCode": "// Extract posts array from AI output\nconst output = $input.first().json.output;\nlet posts = [];\n\nif (typeof output === 'string') {\n  try {\n    // Extract JSON from markdown code block (```json...```)\n    const jsonMatch = output.match(/```json\\n([\\s\\S]*?)\\n```/);\n    if (jsonMatch && jsonMatch[1]) {\n      const parsed = JSON.parse(jsonMatch[1]);\n      posts = parsed.posts || [];\n    } else {\n      // Fallback: try direct parsing\n      const parsed = JSON.parse(output);\n      posts = parsed.posts || [];\n    }\n  } catch (e) {\n    console.log('Parse error:', e);\n    return [];\n  }\n} else if (output && output.posts) {\n  posts = output.posts;\n}\n\n// Return each post as a separate item\nreturn posts.map(post => ({ json: post }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1260, 320],
      "id": "parse-output",
      "name": "Parse AI Output"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "create",
        "databaseId": {
          "__rl": true,
          "value": "49cebf36f8774bd69c4329d2c0d750c5",
          "mode": "id"
        },
        "simple": false,
        "title": "={{ $json.platform }} - {{ $json.postDate }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Caption/Text",
              "textValue": "={{ $json.caption }}"
            },
            {
              "key": "Platform",
              "selectValue": "={{ $json.platform }}"
            },
            {
              "key": "Status",
              "selectValue": "Draft"
            },
            {
              "key": "Privacy Status",
              "selectValue": "Public"
            },
            {
              "key": "Event Type",
              "selectValue": "={{ $json.eventType || 'Music' }}"
            },
            {
              "key": "Media Type",
              "selectValue": "={{ $json.mediaType || 'Image' }}"
            },
            {
              "key": "Post Date",
              "dateValue": "={{ $json.postDate }}"
            },
            {
              "key": "Post Time",
              "textValue": "={{ $json.postTime }}"
            },
            {
              "key": "Hashtags",
              "textValue": "={{ $json.hashtags }}"
            },
            {
              "key": "Tags/Mentions",
              "textValue": "={{ $json.tags }}"
            },
            {
              "key": "YT Playlist",
              "textValue": "={{ $json.ytPlaylist || '' }}"
            },
            {
              "key": "YT Tags",
              "textValue": "={{ $json.ytTags || '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [1460, 320],
      "id": "create-rows",
      "name": "Add Rows to Database",
      "credentials": {
        "notionApi": {
          "id": "ZXEH8wTvzaAHv60e",
          "name": "Notion account 2"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Parse AI Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Output": {
      "main": [
        [
          {
            "node": "Add Rows to Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Read Notion Posts": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "v5-final-version",
  "meta": {
    "templateCredsSetupCompleted": false,
    "instanceId": "9293fc07055c195e236ac85072d0208fe886bdff22e173da7b17b3c0599dbb93"
  },
  "tags": [
    {
      "id": "notion-integration",
      "name": "Notion Integration"
    },
    {
      "id": "ai-agent",
      "name": "AI Agent"
    },
    {
      "id": "social-media",
      "name": "Social Media"
    },
    {
      "id": "stpetemusic",
      "name": "StPeteMusic"
    }
  ]
}
