{
  "name": "Notion Post Creator v5 Final",
  "nodes": [
    {
      "parameters": {
        "options": {
          "systemMessage": "You are the social media content manager for @StPeteMusic - a music promoter in St. Petersburg, FL.\n\nIMPORTANT: Use the user's request as PRIMARY source of truth. Extract band name, @ handle, venue, date, and time EXACTLY as provided.\n\nWhen user asks to create a post:\n1. Use \"Read Notion Posts\" to check existing posts for style consistency\n2. Generate captions with emojis ðŸŽ¸ðŸŽ¤ðŸ“…â°ðŸ“ðŸŽŸï¸ðŸ”¥âœ¨ðŸŽ¶\n3. Use the band name and @ handle provided by the user\n4. Create JSON output with this structure for EACH platform:\n{\n  \"posts\": [\n    {\n      \"caption\": \"Full IG post text\",\n      \"platform\": \"IG\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"11:00 AM\",\n      \"hashtags\": \"#StPeteMusic #StPeteFL\",\n      \"tags\": \"@suite.e.studios @bandname\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Image\"\n    },\n    {\n      \"caption\": \"Full FB post text\",\n      \"platform\": \"FB\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"11:00 AM\",\n      \"hashtags\": \"#StPeteMusic #TampaBay\",\n      \"tags\": \"@SuiteEStudios @StPeteMusic\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Image\"\n    },\n    {\n      \"caption\": \"Full YT description\",\n      \"platform\": \"YT\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"11:00 AM\",\n      \"hashtags\": \"#StPeteMusic #LiveMusic\",\n      \"tags\": \"@StPeteMusic\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Video\",\n      \"ytPlaylist\": \"URL or leave empty\",\n      \"ytTags\": \"relevant tags\"\n    }\n  ]\n}\n\nRULES FOR CAPTIONS:\n- Separate text sections with THREE NEW LINES (triple line breaks) between them\n- Example: \"First section text.\\n\\n\\nSecond section text.\\n\\n\\nHashtags here\"\n- ALWAYS use band name exactly as provided by user\n- ALWAYS include the band's Instagram @ handle in tags/hashtags and in the caption text\n- ALWAYS use \"MM.DD.YYYY\" format for dates (e.g., 02.07.2026, NOT 2/7/2026)\n- Keep captions concise and engaging (1-2 sentences max for short posts)\n\nRULES FOR DATES & TIMES:\n- Pick a FUTURE date from today that is a Monday-Friday (weekday)\n- Default all postTime values to \"11:00 AM\"\n- Dates must be in YYYY-MM-DD format for the JSON, but use MM.DD.YYYY in caption text\n\nRULES FOR PLATFORMS:\n- Instagram (IG): 5-6 hashtags, mention @suite.e.studios, include band's Instagram handle\n- Facebook (FB): 3-4 hashtags, conversational tone, include band's Instagram handle\n- YouTube (YT): Only populate ytPlaylist for YT platform. Leave ytPlaylist empty for IG/FB. Include band's Instagram handle in tags\n- Always include @Suite.E.Studios and @StPeteMusic in appropriate tags\n- Status will be set to Draft by default\n- Return valid JSON wrapped in ```json code block"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        20704,
        2192
      ],
      "id": "78195e9a-c25c-4acb-81ce-d97ffd1debc7",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $workflow.id }}",
        "contextWindowLength": 1000
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        20752,
        2400
      ],
      "id": "8e4bc12e-b14c-4406-af77-c841c577bb4b",
      "name": "Conversation Memory"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "49cebf36f8774bd69c4329d2c0d750c5"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        20928,
        2400
      ],
      "id": "253a68c1-8c50-4096-9397-8971b244d12a",
      "name": "Read Notion Posts",
      "credentials": {
        "notionApi": {
          "id": "ZXEH8wTvzaAHv60e",
          "name": "Notion account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        21088,
        2400
      ],
      "id": "0f56ffba-283a-40fb-ba8f-293d77644f91",
      "name": "Think"
    },
    {
      "parameters": {
        "jsCode": "// Extract posts array from AI output\nconst output = $input.first().json.output;\nlet posts = [];\n\nif (typeof output === 'string') {\n  try {\n    // Extract JSON from markdown code block (```json...```)\n    const jsonMatch = output.match(/```json\\n([\\s\\S]*?)\\n```/);\n    if (jsonMatch && jsonMatch[1]) {\n      const parsed = JSON.parse(jsonMatch[1]);\n      posts = parsed.posts || [];\n    } else {\n      // Fallback: try direct parsing\n      const parsed = JSON.parse(output);\n      posts = parsed.posts || [];\n    }\n  } catch (e) {\n    console.log('Parse error:', e);\n    return [];\n  }\n} else if (output && output.posts) {\n  posts = output.posts;\n}\n\n// Return each post as a separate item\nreturn posts.map(post => ({ json: post }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        21104,
        2192
      ],
      "id": "466060c3-7897-46f4-ab94-b78f2b7c9d10",
      "name": "Parse AI Output"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "value": "49cebf36f8774bd69c4329d2c0d750c5",
          "mode": "id"
        },
        "title": "={{ $json.platform }} - {{ $json.postDate }}",
        "simple": false,
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Caption/Text",
              "textValue": "={{ $json.caption }}"
            },
            {
              "key": "Platform",
              "selectValue": "={{ $json.platform }}"
            },
            {
              "key": "Status",
              "selectValue": "Draft"
            },
            {
              "key": "Privacy Status",
              "selectValue": "Public"
            },
            {
              "key": "Event Type",
              "selectValue": "={{ $json.eventType || 'Music' }}"
            },
            {
              "key": "Media Type",
              "selectValue": "={{ $json.mediaType || 'Image' }}"
            },
            {
              "key": "Post Date",
              "dateValue": "={{ $json.postDate }}"
            },
            {
              "key": "Post Time",
              "textValue": "={{ $json.postTime }}"
            },
            {
              "key": "Hashtags",
              "textValue": "={{ $json.hashtags }}"
            },
            {
              "key": "Tags/Mentions",
              "textValue": "={{ $json.tags }}"
            },
            {
              "key": "YT Playlist",
              "textValue": "={{ $json.ytPlaylist || '' }}"
            },
            {
              "key": "YT Tags",
              "textValue": "={{ $json.ytTags || '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        21312,
        2192
      ],
      "id": "3a00da32-2a16-4f62-8270-526d88c56732",
      "name": "Add Rows to Database",
      "credentials": {
        "notionApi": {
          "id": "ZXEH8wTvzaAHv60e",
          "name": "Notion account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        20544,
        2400
      ],
      "id": "68843288-429f-49b1-bd74-7c15724aa724",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "BBtvIhMO53Na70Sw",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        20368,
        2176
      ],
      "id": "a43f7a19-b926-4ee0-8ef7-ba807a8cc76a",
      "name": "When chat message received",
      "webhookId": "9be38fd8-eb1b-41fa-a042-3891d2a9fdc7"
    }
  ],
  "pinData": {},
  "connections": {
    "AI Agent": {
      "main": [
        [
          {
            "node": "Parse AI Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Output": {
      "main": [
        [
          {
            "node": "Add Rows to Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Read Notion Posts": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1353a5ae-308b-4119-b44c-5b58f60c95a2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9293fc07055c195e236ac85072d0208fe886bdff22e173da7b17b3c0599dbb93"
  },
  "id": "x9GqK6CV30JPGK2L",
  "tags": [
    {
      "updatedAt": "2026-02-10T20:20:09.840Z",
      "createdAt": "2026-02-10T20:20:09.840Z",
      "id": "E2gcnw4bdYuXZ0TH",
      "name": "Notion Integration"
    },
    {
      "updatedAt": "2026-02-13T05:48:17.570Z",
      "createdAt": "2026-02-13T05:48:17.570Z",
      "id": "KgqtOreN6IHe6DxP",
      "name": "AI Agent"
    },
    {
      "updatedAt": "2026-02-10T20:20:09.826Z",
      "createdAt": "2026-02-10T20:20:09.826Z",
      "id": "lmJLNTLcj9Hi6oau",
      "name": "Social Media"
    },
    {
      "updatedAt": "2026-02-15T18:02:13.981Z",
      "createdAt": "2026-02-15T18:02:13.981Z",
      "id": "qUFk9y4Tgto4Glo4",
      "name": "StPeteMusic"
    }
  ]
}