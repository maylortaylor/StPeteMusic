{
  "name": "Notion Post Creator v5 Final",
  "nodes": [
    {
      "parameters": {
        "options": {
          "systemMessage": "You are the social media content manager for @StPeteMusic - a music promoter in St. Petersburg, FL.\n\nIMPORTANT: Use the user's request as PRIMARY source of truth. Extract band name, @ handle, venue, date, and time EXACTLY as provided.\n\nWhen user asks to create a post:\n1. Use \"Read Notion Posts\" to check existing posts for style consistency\n2. Generate captions with emojis ðŸŽ¸ðŸŽ¤ðŸ“…â°ðŸ“ðŸŽŸï¸ðŸ”¥âœ¨ðŸŽ¶\n3. Use the band name and @ handle provided by the user\n4. Create JSON output with this structure for EACH platform:\n{\n  \"posts\": [\n    {\n      \"caption\": \"Full IG post text\",\n      \"platform\": \"IG\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"11:00 AM\",\n      \"hashtags\": \"#StPeteMusic #StPeteFL\",\n      \"tags\": \"@suite.e.studios @bandInstagramHandle\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Video\"\n    },\n    {\n      \"caption\": \"Full FB post text\",\n      \"platform\": \"FB\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"11:00 AM\",\n      \"hashtags\": \"#StPeteMusic #TampaBay\",\n      \"tags\": \"@SuiteEStudios @bandInstagramHandle\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Video\"\n    },\n    {\n      \"caption\": \"Full YT description\",\n      \"platform\": \"YT\",\n      \"postDate\": \"YYYY-MM-DD\",\n      \"postTime\": \"11:00 AM\",\n      \"hashtags\": \"#StPeteMusic #LiveMusic\",\n      \"tags\": \"@StPeteMusic @bandInstagramHandle\",\n      \"eventType\": \"Music\",\n      \"mediaType\": \"Video\",\n      \"ytPlaylist\": \"URL or leave empty\",\n      \"ytTags\": \"relevant tags\"\n    }\n  ]\n}\n\nRULES FOR CAPTIONS - CRITICAL:\n- Format: \"[Main story]\\n\\n\\n[Call to action with emoji]\\n\\n\\n[Hashtags]\"\n- ALWAYS put THREE NEW LINES (\\n\\n\\n) AFTER each section of text\n- Example: \"Relive the incredible energy! ðŸŽ¬ We're still buzzing from Aliqua's killer performance at @Suite.E.Studios on 02.07.2026.\\n\\n\\nðŸŽ¸ Watch the full highlights here...\"\n- ALWAYS use band name exactly as provided by user\n- ALWAYS include the band's Instagram @ handle in tags/hashtags and in the caption text\n- ALWAYS use \"MM.DD.YYYY\" format for dates (e.g., 02.07.2026, NOT 2/7/2026)\n- Keep captions concise and engaging (1-2 sentences per section)\n\nRULES FOR DATES & TIMES - CRITICAL:\n- Check the current date and pick a postDate that is in the FUTURE (not today, not in the past)\n- The postDate must fall on a Monday-Friday (weekday), NOT Saturday or Sunday\n- Default all postTime values to \"11:00 AM\"\n- Dates must be in YYYY-MM-DD format for the JSON, but use MM.DD.YYYY in caption text\n\nRULES FOR TAGS/MENTIONS - CRITICAL:\n- Instagram (IG): \"@suite.e.studios @bandInstagramHandle\" (include band's Instagram)\n- Facebook (FB): \"@SuiteEStudios @bandInstagramHandle\" (include band's Instagram)\n- YouTube (YT): \"@StPeteMusic @bandInstagramHandle\" (include band's Instagram)\n- EVERY platform must include the band's Instagram handle in tags\n- Always include @Suite.E.Studios or @SuiteEStudios in IG/FB\n- Only populate ytPlaylist for YT platform. Leave ytPlaylist empty for IG/FB\n- Status will be set to Draft by default\n- Return valid JSON wrapped in ```json code block"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        20848,
        2464
      ],
      "id": "b9dfe02e-e52c-4566-9f3a-f6d95c1c24fd",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $workflow.id }}",
        "contextWindowLength": 1000
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        20896,
        2672
      ],
      "id": "54516b37-f068-4868-b0fb-d2a40048b981",
      "name": "Conversation Memory"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "49cebf36f8774bd69c4329d2c0d750c5"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        21072,
        2672
      ],
      "id": "ac313a10-a59d-4180-b394-ea4b2e92297d",
      "name": "Read Notion Posts",
      "credentials": {
        "notionApi": {
          "id": "ZXEH8wTvzaAHv60e",
          "name": "Notion account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        21232,
        2672
      ],
      "id": "d3387b75-e0c7-4de0-b490-ba614b9cf0b6",
      "name": "Think"
    },
    {
      "parameters": {
        "jsCode": "// Extract posts array from AI output\nconst output = $input.first().json.output;\nlet posts = [];\n\nif (typeof output === 'string') {\n  try {\n    // Extract JSON from markdown code block (```json...```)\n    const jsonMatch = output.match(/```json\\n([\\s\\S]*?)\\n```/);\n    if (jsonMatch && jsonMatch[1]) {\n      const parsed = JSON.parse(jsonMatch[1]);\n      posts = parsed.posts || [];\n    } else {\n      // Fallback: try direct parsing\n      const parsed = JSON.parse(output);\n      posts = parsed.posts || [];\n    }\n  } catch (e) {\n    console.log('Parse error:', e);\n    return [];\n  }\n} else if (output && output.posts) {\n  posts = output.posts;\n}\n\n// Return each post as a separate item\nreturn posts.map(post => ({ json: post }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        21248,
        2464
      ],
      "id": "c8b42db6-8b5d-4efe-b192-35fefe36e574",
      "name": "Parse AI Output"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "value": "49cebf36f8774bd69c4329d2c0d750c5",
          "mode": "id"
        },
        "title": "={{ $json.platform }} - {{ $json.postDate }}",
        "simple": false,
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Post Content|rich_text",
              "textContent": "={{ $json.caption }}"
            },
            {
              "key": "Platform|select",
              "selectValue": "={{ $json.platform }}"
            },
            {
              "key": "Status|status",
              "selectValue": "Draft",
              "statusValue": "=Draft"
            },
            {
              "key": "Privacy Status|select",
              "selectValue": "=Public"
            },
            {
              "key": "Event Type|select",
              "selectValue": "={{ $json.eventType || 'Music' }}"
            },
            {
              "key": "Media Type|select",
              "selectValue": "={{ $json.mediaType || 'Video' }}"
            },
            {
              "key": "Post Date|date",
              "date": "={{ $json.postDate }}"
            },
            {
              "key": "Post Time|rich_text",
              "textContent": "={{ $json.postTime }}"
            },
            {
              "key": "Hashtags|rich_text",
              "textContent": "={{ $json.hashtags }}"
            },
            {
              "key": "Tags / Mentions|rich_text",
              "textContent": "={{ $json.tags }}"
            },
            {
              "key": "YT Playlist|rich_text",
              "textContent": "={{ $json.ytPlaylist || '' }}"
            },
            {
              "key": "YT Tags|rich_text",
              "textContent": "={{ $json.ytTags || '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        21456,
        2464
      ],
      "id": "164a9cb6-17a6-410f-8b1c-c8f6da5a47b4",
      "name": "Add Rows to Database",
      "credentials": {
        "notionApi": {
          "id": "ZXEH8wTvzaAHv60e",
          "name": "Notion account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        20688,
        2672
      ],
      "id": "de08d621-96fd-4259-bd82-76584a01e4ef",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "BBtvIhMO53Na70Sw",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        20512,
        2448
      ],
      "id": "a436e7e0-bf01-4bc7-b644-9baa112185e6",
      "name": "When chat message received",
      "webhookId": "9be38fd8-eb1b-41fa-a042-3891d2a9fdc7"
    }
  ],
  "pinData": {},
  "connections": {
    "AI Agent": {
      "main": [
        [
          {
            "node": "Parse AI Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Output": {
      "main": [
        [
          {
            "node": "Add Rows to Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Read Notion Posts": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8eb3b242-278b-4cfc-a561-e4f507a844af",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9293fc07055c195e236ac85072d0208fe886bdff22e173da7b17b3c0599dbb93"
  },
  "id": "x9GqK6CV30JPGK2L",
  "tags": [
    {
      "updatedAt": "2026-02-10T20:20:09.840Z",
      "createdAt": "2026-02-10T20:20:09.840Z",
      "id": "E2gcnw4bdYuXZ0TH",
      "name": "Notion Integration"
    },
    {
      "updatedAt": "2026-02-13T05:48:17.570Z",
      "createdAt": "2026-02-13T05:48:17.570Z",
      "id": "KgqtOreN6IHe6DxP",
      "name": "AI Agent"
    },
    {
      "updatedAt": "2026-02-10T20:20:09.826Z",
      "createdAt": "2026-02-10T20:20:09.826Z",
      "id": "lmJLNTLcj9Hi6oau",
      "name": "Social Media"
    },
    {
      "updatedAt": "2026-02-15T18:02:13.981Z",
      "createdAt": "2026-02-15T18:02:13.981Z",
      "id": "qUFk9y4Tgto4Glo4",
      "name": "StPeteMusic"
    }
  ]
}